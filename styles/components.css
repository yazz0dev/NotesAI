/* --- Header & Calendar styles remain the same --- */
.calendar-widget { position: absolute; left: 1.5rem; top: 1.5rem; width: 130px; height: 130px; perspective: 1000px; pointer-events: auto; position: relative; }
/* Glowing indicator for ambient listening */
.calendar-widget::after {
    content: '';
    position: absolute;
    top: -8px; left: -8px; right: -8px; bottom: -8px;
    border-radius: 12px;
    border: 2px solid transparent;
    transition: all 0.5s ease;
    pointer-events: none;
    opacity: 0;
}
.calendar-widget.is-ambient-listening::after {
    opacity: 1;
    border-color: var(--accent-color);
    animation: glow 4s infinite ease-in-out;
}
.calendar-widget.is-command-mode::after {
    opacity: 1;
    border-color: var(--danger-color);
    animation: glow 1.5s infinite ease-in-out;
}
.calendar-page { position: absolute; width: 100%; height: 100%; border-radius: 4px; box-shadow: 0 4px 10px rgba(0,0,0,0.4); overflow: hidden; font-family: var(--font-sans); backface-visibility: hidden; }
#calendar-today { z-index: 2; }
#calendar-today.is-peeling::before { content: ''; position: absolute; bottom: 0; right: 0; background: linear-gradient(135deg, transparent 50%, rgba(0,0,0,0.3) 51%); box-shadow: -2px 2px 5px rgba(0,0,0,0.3); animation: peel-corner 1.5s ease-in-out; }
#calendar-today.is-peeling .calendar-bottom { animation: flutter-text 1.5s ease-in-out; }
#calendar-tomorrow { z-index: 1; background-color: #e0e0e0; }
#calendar-tomorrow .calendar-bottom { background-color: #e9e9e9; }
.calendar-top { background-color: var(--danger-color); color: #fff; padding: 0.3rem; text-align: center; }
#calendar-day-name, #calendar-day-name-tomorrow { font-size: 0.8rem; font-weight: 700; letter-spacing: 1px; text-transform: uppercase; }
.calendar-bottom { padding: 0.5rem; text-align: center; color: #333; background-color: #f9f9f9; height: 100%; transform-origin: top left; }
#calendar-day-number, #calendar-day-number-tomorrow { font-size: 3rem; font-weight: 700; line-height: 1; display: block; margin-top: 0.25rem; }
.calendar-month-year { font-size: 0.7rem; font-weight: 500; text-transform: uppercase; color: #555; display: flex; justify-content: center; gap: 0.25rem; }


/* --- NEW Journal Card on Shelf --- */
.journal-card {
    width: 240px;
    height: 280px;
    margin: 0 1rem;
    background-color: var(--surface-color);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
    cursor: pointer;
    transition: transform 0.3s ease, box-shadow 0.3s ease, border-color 0.3s ease;
    border-top-width: 4px; /* Make space for the accent color */
    animation: fadeInUp 0.5s ease-out both; /* Staggered load animation */
}

.journal-card:hover {
    transform: translateY(-10px);
    box-shadow: 0 10px 20px rgba(0,0,0,0.4);
    border-color: var(--accent-color);
}

/* Tactile Feedback on Click */
.journal-card:active {
    transform: translateY(-5px) scale(0.98);
    box-shadow: 0 6px 12px rgba(0,0,0,0.3);
}

.card-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-primary);
    line-height: 1.3;
    margin-bottom: 0.75rem;
    /* Limit to 2 lines with ellipsis */
    display: -webkit-box;
    display: box;
    -webkit-line-clamp: 2;
    line-clamp: 2;
    -webkit-box-orient: vertical;
    box-orient: vertical;
    overflow: hidden;
}

.card-snippet {
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
    flex-grow: 1; /* Pushes the date to the bottom */
    /* Limit to 5 lines with ellipsis */
    display: -webkit-box;
    display: box;
    -webkit-line-clamp: 5;
    line-clamp: 5;
    -webkit-box-orient: vertical;
    box-orient: vertical;
    overflow: hidden;
}

.card-date {
    font-size: 0.8rem;
    color: var(--text-secondary);
    opacity: 0.7;
    text-align: right;
    margin-top: 1rem;
}

/* --- Empty States (Welcome & Search) --- */
.empty-state-container {
    width: 100%;
    text-align: center;
    padding: 4rem 2rem;
}

.empty-state-container.hidden {
    display: none;
}

.empty-state-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
}

.empty-state-text {
    font-size: 1rem;
    color: var(--text-secondary);
    max-width: 400px;
    margin: 0 auto;
    line-height: 1.6;
}

.empty-state-text strong {
    color: var(--accent-color);
    font-weight: 500;
}

/* --- NEW: On This Day Widget --- */
.on-this-day-widget {
    position: absolute;
    top: 1.5rem;
    right: 1.5rem;
    max-width: 350px;
    background-color: rgba(30, 30, 30, 0.8);
    backdrop-filter: blur(5px);
    border: 1px solid var(--border-color);
    border-radius: 12px;
    padding: 1rem 1.25rem;
    box-shadow: 0 4px 10px rgba(0,0,0,0.3);
    color: var(--text-secondary);
    animation: fadeIn 0.5s ease-out;
}

.on-this-day-widget.hidden {
    display: none;
}

.on-this-day-title {
    font-size: 0.9rem;
    font-weight: 700;
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    display: flex;
    align-items: center;
}

.on-this-day-title::before {
    content: '‚è≥';
    margin-right: 0.5rem;
    font-size: 1.1rem;
}

.on-this-day-summary {
    font-size: 0.9rem;
    line-height: 1.5;
    font-style: italic;
}


/* --- REVAMPED Two-Page Book Viewer (styles remain the same) --- */
.book-viewer-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); backdrop-filter: blur(8px); z-index: 900; opacity: 0; pointer-events: none; transition: opacity 0.5s ease; perspective: 2000px; }
.book-viewer-overlay:not(.hidden) { opacity: 1; pointer-events: auto; }
.book-viewer-content { width: 90vw; max-width: 1600px; height: 90vh; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%) rotateY(90deg) scale(0.5); transform-origin: center; transition: transform 0.6s cubic-bezier(0.2, 1, 0.3, 1); }
.book-viewer-overlay.is-open .book-viewer-content { transform: translate(-50%, -50%) rotateY(0deg) scale(1); }
.book-layout { display: flex; width: 100%; height: 100%; background: #2c2c2c; box-shadow: 0 25px 50px -12px rgba(0,0,0,0.75); }
.book-spine { width: 2rem; background: linear-gradient(to right, #1a1a1a 0%, #3a3a3a 50%, #1a1a1a 100%); flex-shrink: 0; }
.book-page { flex: 1; background-color: #f3f0e9; color: #3a3a3a; padding: 3rem 4rem; overflow-y: auto; }
#page-left { border-radius: 8px 0 0 8px; }
#page-right { border-radius: 0 8px 8px 0; }
.page-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 2rem;
    border-bottom: 1px solid #ddd;
    padding-bottom: 1rem;
}

.header-text {
    flex-grow: 1;
}

#viewer-title { font-family: var(--font-sans); font-size: 2rem; font-weight: 700; margin-bottom: 0.5rem; }
#viewer-date { font-family: var(--font-sans); font-style: italic; color: #777; }

/* Viewer Buttons */
.header-actions { display: flex; gap: 0.5rem; }
.viewer-btn { background-color: var(--primary-color); color: var(--text-primary); border: 1px solid var(--border-color); padding: 0.5rem 1rem; border-radius: 6px; cursor: pointer; transition: background-color 0.2s; font-weight: 500; }
.viewer-btn:hover { background-color: var(--hover-color); }
.viewer-btn.danger { background-color: transparent; color: var(--danger-color); border-color: var(--danger-color); }
.viewer-btn.danger:hover { background-color: var(--danger-color); color: white; }
.viewer-btn.hidden { display: none; }
.viewer-text { font-family: var(--font-journal); font-size: 1.7rem; line-height: 2.3rem; background-image: repeating-linear-gradient(to bottom, transparent, transparent 2.2rem, #e0e0e0 2.3rem); background-size: 100% 2.3rem; }
.viewer-text p { margin-bottom: 1rem; }
.viewer-text p:first-child { text-indent: 3rem; margin-top: 0; }
.close-viewer-btn { position: absolute; top: 1rem; right: 1rem; background: rgba(0,0,0,0.3); border: none; font-size: 2rem; color: #fff; cursor: pointer; line-height: 1; opacity: 0.8; transition: opacity 0.2s ease, transform 0.2s ease; z-index: 901; border-radius: 50%; width: 40px; height: 40px; display: flex; justify-content: center; align-items: center; }
.close-viewer-btn:hover { opacity: 1; transform: scale(1.1); background: rgba(0,0,0,0.5); }

/* --- Action Bar and other components remain the same --- */
.action-bar { display: flex; align-items: center; width: 100%; max-width: 600px; background-color: var(--surface-color); border-radius: 30px; padding: 0.5rem; border: 1px solid var(--border-color); box-shadow: 0 5px 15px rgba(0,0,0,0.3); pointer-events: auto; transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); gap: 0.5rem; }
.action-bar.error { animation: shake 0.5s ease-in-out, errorFlash 0.5s ease-in-out; }
.action-bar.processing { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3), 0 8px 20px rgba(0,0,0,0.4); }

/* Feedback Animations */
@keyframes shake {
    0%, 100% { transform: translateX(0); }
    25% { transform: translateX(-5px); }
    75% { transform: translateX(5px); }
}
@keyframes errorFlash {
    0% { background-color: var(--surface-color); }
    50% { background-color: rgba(255, 82, 82, 0.2); }
    100% { background-color: var(--surface-color); }
}
.settings-btn {
    background: none; border: none; font-size: 1.5rem; color: var(--text-secondary);
    cursor: pointer; transition: color 0.2s, transform 0.2s; padding: 0 0.5rem;
}
.settings-btn:hover { color: var(--text-primary); transform: rotate(45deg); }
.action-bar.is-focused { border-color: var(--accent-color); box-shadow: 0 0 0 3px rgba(0, 122, 255, 0.3), 0 8px 20px rgba(0,0,0,0.4); }
.search-input { flex-grow: 1; background: none; border: none; color: var(--text-primary); font-size: 1rem; padding: 0.5rem 1rem; outline: none; cursor: text; min-height: 28px; max-height: 120px; overflow-y: auto; white-space: pre-wrap; word-wrap: break-word; transition: flex-grow 0.4s cubic-bezier(0.25, 0.8, 0.25, 1); }
.search-input:empty::before { content: "Ask about your past, or start a new entry..."; color: var(--text-secondary); cursor: text; pointer-events: none; transition: opacity 0.2s ease; }
.search-input:focus::before { opacity: 0; }
.action-bar.is-focused .search-input { flex-grow: 5; }
.mic-button { width: 48px; height: 48px; border-radius: 50%; border: none; background-color: var(--accent-color); color: white; display: flex; justify-content: center; align-items: center; cursor: pointer; transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1); flex-shrink: 0; position: relative; overflow: hidden; }
.mic-button::after { content: ''; position: absolute; top: 50%; left: 50%; width: 5px; height: 5px; background: rgba(255, 255, 255, 0.5); opacity: 0; border-radius: 50%; transform: scale(1) translate(-50%, -50%); transform-origin: 50% 50%; }
.mic-button:active::after { transition: 0s; transform: scale(30) translate(-50%, -50%); opacity: 1; }
.mic-button:hover:not(.is-listening):not(.is-capturing) { transform: scale(1.1); box-shadow: 0 0 20px rgba(0, 122, 255, 0.6); }
.mic-button.is-listening { animation: glow 4s infinite ease-in-out; }
.mic-button.is-hearing { animation: glow 1.5s infinite ease-in-out; }
.mic-button.is-capturing { background-color: var(--danger-color); box-shadow: 0 0 20px rgba(255, 69, 58, 0.6); transform: scale(0.9); }
.mic-button.is-processing { background-color: var(--hover-color); transform: rotate(360deg); cursor: default; }
.mic-button img { position: absolute; transition: opacity 0.2s ease, transform 0.2s ease; }
.modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 1000; opacity: 1; pointer-events: auto; transition: opacity 0.3s ease; }
.modal-overlay.hidden { opacity: 0; pointer-events: none; }
.modal-dialog { background-color: var(--surface-color); padding: 2rem; border-radius: 12px; box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5); width: 90%; max-width: 400px; text-align: center; transform: scale(1); transition: transform 0.3s ease, opacity 0.3s ease; }
.modal-overlay.hidden .modal-dialog { transform: scale(0.95); opacity: 0; }
.modal-title { font-size: 1.25rem; font-weight: 700; margin-bottom: 0.75rem; color: var(--text-primary); }
.modal-message { font-size: 1rem; line-height: 1.6; color: var(--text-secondary); margin-bottom: 1.5rem; }
.modal-actions { display: flex; gap: 1rem; justify-content: center; }
.modal-btn { flex-grow: 1; padding: 0.75rem 1rem; border: none; border-radius: 8px; font-size: 1rem; font-weight: 500; cursor: pointer; transition: background-color 0.2s ease, transform 0.1s ease; }
.modal-btn:active { transform: scale(0.98); }
.modal-btn-cancel { background-color: var(--primary-color); color: var(--text-primary); }
.modal-btn-cancel:hover { background-color: var(--hover-color); }
.modal-btn-confirm { background-color: var(--danger-color); color: white; }
.modal-btn-confirm:hover { background-color: #d9362e; }

/* --- Settings Modal --- */
.setting-item { display: flex; justify-content: space-between; align-items: center; margin-bottom: 0.5rem; }
.setting-item.disabled label { color: var(--text-secondary); cursor: not-allowed; }
.setting-description { font-size: 0.8rem; color: var(--text-secondary); margin-bottom: 1.5rem; line-height: 1.5; }
.setting-divider { border: none; height: 1px; background-color: var(--border-color); margin: 1.5rem 0; }
/* Toggle Switch CSS */
.toggle-switch { position: relative; display: inline-block; width: 50px; height: 28px; }
.toggle-switch input { opacity: 0; width: 0; height: 0; }
.slider { position: absolute; cursor: pointer; top: 0; left: 0; right: 0; bottom: 0; background-color: var(--primary-color); transition: .4s; border-radius: 28px; }
.slider:before { position: absolute; content: ""; height: 20px; width: 20px; left: 4px; bottom: 4px; background-color: white; transition: .4s; border-radius: 50%; }
input:checked + .slider { background-color: var(--accent-color); }
input:checked + .slider:before { transform: translateX(22px); }
input:disabled + .slider { background-color: #333; cursor: not-allowed; }

/* --- Book Viewer --- */
.viewer-text img {
    max-width: 80%;
    display: block;
    margin: 1.5rem auto;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
}
.viewer-text figcaption {
    display: block;
    text-align: center;
    font-size: 0.9rem;
    font-style: italic;
    color: #777;
    margin-top: -0.5rem;
    margin-bottom: 1.5rem;
}
.header-actions { display: flex; flex-wrap: wrap; gap: 0.5rem; } /* Allow wrapping */