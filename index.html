<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Notes & Tasks</title>
    <link rel="stylesheet" href="styles/main.css" />
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Caveat:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <!-- Iconify CDN for icons -->
    <script src="https://code.iconify.design/2/2.2.1/iconify.min.js"></script>
  </head>
  <body>
    <header id="app-header" class="app-header">
      <!-- NEW: Recording Indicator -->
      <div id="recording-indicator" class="recording-indicator hidden">
        <div class="recording-dot"></div>
        <span>Recording</span>
        <span id="recording-time" class="recording-time">0:00</span>
      </div>
    </header>

    <!-- Modern two-pane layout -->
    <div id="app-layout" class="app-layout">
      <!-- Sidebar Navigation -->
      <aside id="sidebar" class="sidebar">
        <div class="sidebar-header">
          <h1 class="app-title">Notes & Tasks</h1>
          <button
            id="sidebar-toggle"
            class="sidebar-toggle"
            title="Toggle sidebar"
            aria-label="Toggle navigation sidebar"
          >
            <span
              class="iconify"
              data-icon="material-symbols:menu"
              aria-hidden="true"
            ></span>
          </button>
        </div>

        <nav class="sidebar-nav">
          <div class="nav-section">
            <div class="nav-item active" data-view="all-notes">
              <span class="iconify" data-icon="material-symbols:article"></span>
              <span class="nav-text">All Notes</span>
              <span class="nav-count" id="all-notes-count">0</span>
            </div>
            <div class="nav-item" data-view="favorites">
              <span class="iconify" data-icon="material-symbols:star"></span>
              <span class="nav-text">Favorites</span>
              <span class="nav-count" id="favorites-count">0</span>
            </div>
            <div class="nav-item" data-view="recent">
              <span class="iconify" data-icon="material-symbols:history"></span>
              <span class="nav-text">Recent</span>
            </div>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">
              <span>Notebooks</span>
              <button class="nav-action-btn" title="Add notebook">
                <span class="iconify" data-icon="material-symbols:add"></span>
              </button>
            </div>
            <div class="nav-item" data-notebook="personal">
              <span class="iconify" data-icon="material-symbols:folder"></span>
              <span class="nav-text">Personal</span>
            </div>
            <div class="nav-item" data-notebook="work">
              <span class="iconify" data-icon="material-symbols:folder"></span>
              <span class="nav-text">Work</span>
            </div>
          </div>

          <div class="nav-section">
            <div class="nav-section-title">
              <span>Tags</span>
              <button class="nav-action-btn" title="Manage tags">
                <span
                  class="iconify"
                  data-icon="material-symbols:settings"
                ></span>
              </button>
            </div>
            <div class="tag-list" id="tag-list">
              <!-- Tags will be populated dynamically -->
            </div>
          </div>
        </nav>

        <div class="sidebar-footer">
          <button
            id="new-note-btn"
            class="new-note-btn"
            aria-label="Create new note"
          >
            <span
              class="iconify"
              data-icon="material-symbols:add"
              aria-hidden="true"
            ></span>
            <span>New Note</span>
          </button>
        </div>
      </aside>

      <!-- Main Content Area -->
      <main id="main-content" class="main-content" role="main">
        <!-- Toolbar -->
        <header class="content-toolbar">
          <div class="toolbar-left">
            <div class="search-container">
              <span class="search-icon">
                <span
                  class="iconify"
                  data-icon="material-symbols:search"
                ></span>
              </span>
              <div
                id="search-input"
                class="search-input"
                contenteditable="true"
                role="textbox"
                placeholder="Search notes..."
              ></div>
              <div
                class="search-filters"
                id="search-filters"
                style="display: none"
              >
                <button class="filter-btn active" data-filter="all">All</button>
                <button class="filter-btn" data-filter="title">Title</button>
                <button class="filter-btn" data-filter="content">
                  Content
                </button>
                <button class="filter-btn" data-filter="tags">Tags</button>
              </div>
            </div>
          </div>

          <div class="toolbar-right">
            <button
              id="view-toggle"
              class="view-toggle-btn"
              title="Toggle view"
            >
              <span
                class="iconify"
                data-icon="material-symbols:grid-view"
              ></span>
            </button>
            <button id="sort-btn" class="sort-btn" title="Sort notes">
              <span class="iconify" data-icon="material-symbols:sort"></span>
              <span class="sort-text">Date Modified</span>
            </button>
          </div>
        </header>

        <!-- Notes List Area -->
        <div id="notes-list-container" class="notes-list-container">
          <div id="notes-list" class="notes-list">
            <!-- Notes will be populated by JS -->
          </div>
          <div id="empty-state-container" class="empty-state-container hidden">
            <div class="empty-state-content">
              <span
                class="iconify"
                data-icon="material-symbols:article-outline"
              ></span>
              <h2>No notes yet</h2>
              <p>
                Start writing your first note or create a task to get organized.
              </p>
              <button id="empty-state-new-note" class="empty-state-btn">
                <span class="iconify" data-icon="material-symbols:add"></span>
                Create your first note
              </button>
            </div>
          </div>
        </div>
      </main>

      <!-- Note Editor Panel (appears when note is selected) -->
      <aside id="note-editor" class="note-editor hidden">
        <div class="editor-header">
          <div class="editor-title">
            <input
              type="text"
              id="editor-note-title"
              placeholder="Note title..."
              class="note-title-input"
            />
            <div class="note-meta">
              <span class="note-date" id="note-date"></span>
              <span class="note-word-count" id="note-word-count">0 words</span>
            </div>
          </div>
          <div class="editor-actions">
            <button id="editor-pin-btn" class="editor-btn" title="Pin note">
              <span
                class="iconify"
                data-icon="material-symbols:push-pin-outline"
              ></span>
            </button>
            <button id="editor-tag-btn" class="editor-btn" title="Add tags">
              <span
                class="iconify"
                data-icon="material-symbols:local-offer"
              ></span>
            </button>
            <button id="editor-share-btn" class="editor-btn" title="Share note">
              <span class="iconify" data-icon="material-symbols:share"></span>
            </button>
            <button
              id="editor-close-btn"
              class="editor-btn"
              title="Close editor"
            >
              <span class="iconify" data-icon="material-symbols:close"></span>
            </button>
          </div>
        </div>

        <div class="editor-toolbar" id="editor-toolbar">
          <div class="toolbar-group">
            <button class="format-btn" data-command="bold" title="Bold">
              <span
                class="iconify"
                data-icon="material-symbols:format-bold"
              ></span>
            </button>
            <button class="format-btn" data-command="italic" title="Italic">
              <span
                class="iconify"
                data-icon="material-symbols:format-italic"
              ></span>
            </button>
            <button
              class="format-btn"
              data-command="underline"
              title="Underline"
            >
              <span
                class="iconify"
                data-icon="material-symbols:format-underline"
              ></span>
            </button>
          </div>

          <div class="toolbar-group">
            <button
              class="format-btn"
              data-command="insertUnorderedList"
              title="Bullet List"
            >
              <span
                class="iconify"
                data-icon="material-symbols:format-list-bulleted"
              ></span>
            </button>
            <button
              class="format-btn"
              data-command="insertOrderedList"
              title="Numbered List"
            >
              <span
                class="iconify"
                data-icon="material-symbols:format-list-numbered"
              ></span>
            </button>
          </div>

          <div class="toolbar-group">
            <button
              class="format-btn"
              data-command="formatBlock"
              data-value="h1"
              title="Heading 1"
            >
              H1
            </button>
            <button
              class="format-btn"
              data-command="formatBlock"
              data-value="h2"
              title="Heading 2"
            >
              H2
            </button>
            <button
              class="format-btn"
              data-command="formatBlock"
              data-value="h3"
              title="Heading 3"
            >
              H3
            </button>
          </div>

          <div class="toolbar-group">
            <button
              id="insert-image-btn"
              class="format-btn"
              title="Insert Image"
            >
              <span class="iconify" data-icon="material-symbols:image"></span>
            </button>
            <button id="insert-link-btn" class="format-btn" title="Insert Link">
              <span class="iconify" data-icon="material-symbols:link"></span>
            </button>
            <button
              id="insert-code-btn"
              class="format-btn"
              title="Insert Code Block"
            >
              <span class="iconify" data-icon="material-symbols:code"></span>
            </button>
          </div>
        </div>

        <div class="editor-content">
          <div
            id="note-editor-content"
            class="note-content-editable"
            contenteditable="true"
            placeholder="Start writing your note..."
          ></div>
        </div>

        <div class="editor-footer">
          <div class="editor-status">
            <span id="editor-status" class="status-text">Ready</span>
          </div>
          <div class="editor-actions-footer">
            <button id="editor-save-btn" class="editor-btn primary">
              Save
            </button>
            <button id="editor-cancel-btn" class="editor-btn secondary">
              Cancel
            </button>
          </div>
        </div>
      </aside>
    </div>

    <!-- Hidden file input for image uploads -->
    <input
      type="file"
      id="image-input"
      accept="image/*"
      style="display: none"
    />

    <!-- Hidden file input for import -->
    <input
      type="file"
      id="import-file-input"
      accept=".json,.txt"
      style="display: none"
    />

    <!-- NEW: Settings Modal -->
    <div id="settings-modal" class="modal-overlay settings-modal hidden">
      <div class="modal-dialog settings-dialog">
        <!-- Content will be dynamically generated by settings-view.js -->
      </div>
    </div>

    <!-- App Initialization Loading Overlay -->
    <div id="app-loading-overlay" class="app-loading-overlay">
      <div class="loading-content">
        <div class="loading-spinner"></div>
        <div class="loading-text">
          <h2>Welcome to Notes & Tasks</h2>
          <p id="loading-status">Initializing your workspace...</p>
          <div class="loading-progress">
            <div class="progress-bar" id="loading-progress-bar"></div>
          </div>
          <div class="loading-steps" id="loading-steps">
            <div class="loading-step" data-step="database">
              <span class="step-indicator"></span>
              <span class="step-text">Setting up database</span>
            </div>
            <div class="loading-step" data-step="notes">
              <span class="step-indicator"></span>
              <span class="step-text">Loading your notes</span>
            </div>
            <div class="loading-step" data-step="ai">
              <span class="step-indicator"></span>
              <span class="step-text">Preparing features</span>
            </div>
            <div class="loading-step" data-step="ui">
              <span class="step-indicator"></span>
              <span class="step-text">Finalizing interface</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Goals Modal -->
    <div id="goals-modal" class="modal-overlay hidden">
      <div class="modal-dialog goals-modal-dialog">
        <h2 class="modal-title">Goals & Habits</h2>

        <!-- Goals Dashboard -->
        <div id="goals-dashboard" class="goals-dashboard">
          <div class="goals-stats">
            <div class="stat-item">
              <span class="stat-number" id="active-goals-count">0</span>
              <span class="stat-label">Active</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="completed-goals-count">0</span>
              <span class="stat-label">Completed</span>
            </div>
            <div class="stat-item">
              <span class="stat-number" id="total-streak-count">0</span>
              <span class="stat-label">Streak Days</span>
            </div>
          </div>

          <div class="goals-insights" id="goals-insights">
            <!-- AI insights will be populated here -->
          </div>

          <div class="goals-list" id="goals-list">
            <!-- Goals will be populated here -->
          </div>
        </div>

        <!-- Add/Edit Goal Form -->
        <div id="goal-form" class="goal-form hidden">
          <h3 id="goal-form-title">Add New Goal</h3>
          <form id="goal-form-element">
            <div class="form-group">
              <label for="goal-title-input">Title *</label>
              <input
                type="text"
                id="goal-title-input"
                required
                placeholder="e.g., Exercise daily"
              />
            </div>

            <div class="form-group">
              <label for="goal-description-input">Description</label>
              <textarea
                id="goal-description-input"
                placeholder="What does success look like?"
              ></textarea>
            </div>

            <div class="form-row">
              <div class="form-group">
                <label for="goal-type-select">Type *</label>
                <select id="goal-type-select" required>
                  <option value="habit">Daily Habit</option>
                  <option value="project">Project</option>
                  <option value="milestone">Milestone</option>
                </select>
              </div>

              <div class="form-group">
                <label for="goal-category-input">Category</label>
                <input
                  type="text"
                  id="goal-category-input"
                  placeholder="health, work, personal"
                />
              </div>
            </div>

            <div class="form-row" id="habit-options">
              <div class="form-group">
                <label for="goal-frequency-select">Frequency</label>
                <select id="goal-frequency-select">
                  <option value="daily">Daily</option>
                  <option value="weekly">Weekly</option>
                  <option value="monthly">Monthly</option>
                </select>
              </div>

              <div class="form-group">
                <label for="goal-target-input">Target</label>
                <input type="number" id="goal-target-input" min="1" value="1" />
              </div>
            </div>

            <div class="form-group" id="target-date-group">
              <label for="goal-target-date-input">Target Date</label>
              <input type="date" id="goal-target-date-input" />
            </div>

            <div class="form-actions">
              <button
                type="button"
                id="cancel-goal-btn"
                class="modal-btn modal-btn-cancel"
              >
                Cancel
              </button>
              <button
                type="submit"
                id="save-goal-btn"
                class="modal-btn modal-btn-confirm"
              >
                Save Goal
              </button>
            </div>
          </form>
        </div>

        <div class="modal-actions" id="goals-modal-actions">
          <button id="add-new-goal-btn" class="modal-btn modal-btn-confirm">
            <span class="iconify" data-icon="material-symbols:add"></span> Add
            Goal
          </button>
          <button id="goals-close-btn" class="modal-btn modal-btn-cancel">
            Close
          </button>
        </div>
      </div>
    </div>

    <!-- Confirmation Modal -->
    <div id="confirmation-modal" class="modal-overlay hidden">
      <div class="modal-dialog">
        <h2 id="modal-title" class="modal-title">Confirm Action</h2>
        <p id="modal-message" class="modal-message">
          Are you sure you want to proceed?
        </p>
        <div class="modal-actions">
          <button id="modal-cancel-btn" class="modal-btn modal-btn-cancel">
            Cancel</button
          ><button id="modal-confirm-btn" class="modal-btn modal-btn-confirm">
            Delete
          </button>
        </div>
      </div>
    </div>

    <script type="module" src="js/main.js"></script>
  </body>
</html>
